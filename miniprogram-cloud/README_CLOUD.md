# 大乐透号码预测微信小程序（云开发版本）

基于微信小程序云开发的大乐透号码预测系统，无需自建服务器，使用微信云开发提供的后端服务。

## 🎯 云开发优势

- **无需服务器**：使用微信云开发，免去服务器运维
- **自动扩缩容**：根据访问量自动调整资源
- **内置数据库**：使用云数据库，无需单独配置
- **低成本**：按量计费，初期成本低

## 📱 项目结构

```
miniprogram-cloud/
├── cloud/
│   └── functions/           # 云函数目录
│       ├── predictions/    # 预测结果云函数
│       ├── history/        # 历史数据云函数  
│       ├── dataStatus/     # 数据状态云函数
│       ├── initData/       # 数据初始化云函数
│       └── updateData/     # 数据更新云函数
├── pages/                   # 页面文件
├── utils/                   # 工具类
├── app.js                   # 小程序入口（云开发版本）
├── app.json                 # 小程序配置
└── project.config.json      # 项目配置
```

## 🚀 快速部署

### 步骤1：创建云开发环境

1. **开通云开发**
   - 登录微信小程序管理后台
   - 进入"开发" -> "云开发"
   - 创建云环境（建议创建测试环境）

2. **获取环境ID**
   - 复制云环境ID
   - 修改 `app.js` 中的环境配置

### 步骤2：配置小程序

1. **修改环境配置**
```javascript
// app.js
wx.cloud.init({
  env: 'your-cloud-env-id', // 替换为你的云环境ID
  traceUser: true,
})
```

2. **上传云函数**
   - 在微信开发者工具中右键 cloud/functions 目录
   - 选择"上传并部署：云端安装依赖"

### 步骤3：初始化数据

1. **创建数据库集合**
   - 在云开发控制台创建 `lottery_history` 集合

2. **初始化数据**
   - 调用 `initData` 云函数插入示例数据
   - 或手动导入历史数据

## 🔧 云函数说明

### 1. predictions - 预测结果
- **功能**：分析历史数据，生成热门和冷门号码
- **调用方式**：小程序前端调用
- **返回数据**：预测结果和统计信息

### 2. history - 历史数据
- **功能**：查询历史开奖记录
- **参数**：limit（查询数量）
- **返回数据**：历史开奖数据列表

### 3. dataStatus - 数据状态
- **功能**：获取数据统计信息
- **返回数据**：总记录数、最新期次等

### 4. initData - 数据初始化
- **功能**：初始化示例数据（一次性使用）
- **调用方式**：手动调用或定时任务

### 5. updateData - 数据更新
- **功能**：定时更新最新开奖数据
- **调用方式**：配置定时触发器

## ⚙️ 定时触发器配置

### 配置数据自动更新

1. **创建定时触发器**
```json
{
  "config": {
    "triggers": [
      {
        "name": "updateLotteryData",
        "type": "timer",
        "config": "0 0 22 * * *"  // 每天22点执行
      }
    ]
  }
}
```

2. **部署触发器**
   - 在云函数目录创建 `config.json`
   - 上传触发器配置

## 📊 数据库设计

### lottery_history 集合结构
```javascript
{
  "_id": "自动生成",
  "period": "23118",           // 期次
  "date": "2023-10-16",        // 开奖日期
  "front_numbers": ["02", "09", "15", "22", "31"],  // 前区号码
  "back_numbers": ["03", "08"],                    // 后区号码
  "sales_amount": "3.56亿元",   // 销售额
  "_createTime": "时间戳",      // 创建时间
  "_updateTime": "时间戳"       // 更新时间
}
```

### 索引配置
```javascript
// 按期次倒序索引（提高查询性能）
db.collection('lottery_history').createIndex({
  period: -1
})
```

## 💰 成本估算

### 免费额度
- 云函数：50万次/月
- 数据库：2GB存储
- 存储空间：5GB流量
- CDN：5GB流量

### 典型用量
- 日活跃用户：1000人
- 每人每日调用：5次
- 月总调用：15万次（在免费额度内）

## 🔒 安全配置

### 数据库权限
```javascript
// 安全规则配置
{
  "read": "auth != null",    // 需登录可读
  "write": false             // 禁止前端写入
}
```

### 云函数权限
- 所有数据库操作通过云函数完成
- 前端无法直接操作数据库
- 云函数有完整数据库权限

## 🚀 性能优化

### 1. 数据库优化
- 添加合适的索引
- 使用分页查询
- 避免全表扫描

### 2. 云函数优化
- 使用连接复用
- 合理设置超时时间
- 启用缓存机制

### 3. 前端优化
- 使用本地缓存
- 减少不必要的请求
- 实现数据懒加载

## 🔄 数据更新策略

### 自动更新
- 使用定时触发器每天自动更新
- 失败重试机制
- 更新结果通知

### 手动更新
- 管理员手动触发更新
- 数据校验和去重
- 更新日志记录

## 🤝 扩展功能

### 1. 用户系统
- 微信用户自动登录
- 收藏喜欢的号码组合
- 个性化推荐

### 2. 数据分析
- 号码走势分析
- 中奖概率计算
- 历史统计图表

### 3. 消息推送
- 开奖结果通知
- 个性化提醒
- 活动消息推送

## ⚠️ 注意事项

1. **环境配置**：确保正确配置云环境ID
2. **数据库权限**：合理设置安全规则
3. **云函数超时**：默认3秒，可调整至60秒
4. **成本监控**：定期查看使用量和费用

## 📞 技术支持

- 微信小程序官方文档
- 云开发技术文档
- GitHub项目Issues

---

**最后更新**：2024年10月  
**文档版本**：v1.0